<!-- frontend/templates/index.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>EarthBloom — Observa el florecer de la Tierra</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
  <header>
    <img src="{{ url_for('static', filename='images/EarthBloom_logo.png') }}" class="logo">
    <h1>Observa el florecer de la Tierra</h1>
  </header>
  
  <main>
    <aside id="control-panel">
      <label>Selecciona fecha:</label>
      <input type="date" id="datePicker">
      <label>O elige estación:</label>
      <select id="season">
        <option>Primavera</option>
        <option>Verano</option>
        <option>Otoño</option>
        <option>Invierno</option>
      </select>
      <button onclick="loadBloom()">Analizar floración</button>
    </aside>

    <div id="map"></div>
  </main>

  <script>
    const map = L.map('map').setView([19.4, -99.1], 6);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    async function loadBloom() {
      const date = document.getElementById('datePicker').value;
      const season = document.getElementById('season').value;
      const res = await fetch(`/get_bloom?date=${date}&season=${season}`);
      const data = await res.json();

      L.geoJSON(data, {
        style: f => ({
          color: getColor(f.properties.bloom_probability),
          fillOpacity: 0.6
        })
      }).addTo(map);
    }

    function getColor(prob) {
      return prob > 0.8 ? '#EAFE07' : prob > 0.6 ? '#00C896' : '#006C74';
    }
  </script>
</body>
</html>